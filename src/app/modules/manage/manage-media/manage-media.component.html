@if (coreConfig.manageMedia) {
  <div class="manage-media relative">
    <mat-drawer-container>
      <mat-drawer mode="side" [opened]="true">
        <div
          class="sidebar flex flex-col"
          [class]="{ 'from-static': model.fromStatic }"
        >
          <mat-slider max="12" min="3" step="1"
            ><input matSliderThumb [(ngModel)]="coreConfig.manageMedia.row" />
          </mat-slider>
          @if (coreConfig.manageMedia.sidebar.form) {
            <form [formGroup]="form">
              <app-formly
                [classes]="'form-field-width-auto'"
                [form]="form"
                [fields]="fields"
                [model]="model"
              >
              </app-formly>
            </form>
          }

          @if (!model.fromStatic) {
            <div class="flex justify-center my-5">
              <app-btn
                (click)="onUpload()"
                [content]="{
                  label: '上传媒体',
                  color: 'primary',
                  mode: 'raised',
                  icon: { svg: 'upload-outline' },
                }"
              ></app-btn>
            </div>
          }
        </div>
      </mat-drawer>
      <mat-drawer-content>
        <div class="inner flex flex-col justify-center">
          @if (loading) {
            <div class="load">
              <mat-spinner diameter="50" color="accent"></mat-spinner>
            </div>
          }
          @if (mediaAssets$ | async; as assets) {
            @if (assets.rows.length) {
              <div class="viewport grid grid-cols-12 gap-1 overflow-auto">
                @for (item of assets.rows; track item) {
                  <div
                    class="masonry-item aspect-[4/3] box-border col-span-6 sm:col-span-4 md:col-span-{{
                      coreConfig.manageMedia.row
                    }}"
                    trackBy="trackByFn"
                  >
                    <div class="actions">
                      <app-btn
                        *reqRolesIf="{
                          params: { reqRoles: ['administrator'] },
                        }"
                        class="hidden sm:block"
                        [matTooltip]="'删除'"
                        (click)="onDelete(item.uuid)"
                        [content]="{
                          label: '',
                          mode: 'icon',
                          icon: { svg: 'delete' },
                        }"
                      ></app-btn>
                    </div>
                    <div
                      class="box w-full h-full bg-gray-200 p-3 box-border"
                      (click)="onSelect(item)"
                      [ngClass]="{ selected: isSelected(item) }"
                    >
                      <img
                        class="w-full h-full object-contain"
                        src="{{ item.src }}"
                      />
                    </div>
                  </div>
                }
              </div>
            } @else {
              <div>无数据</div>
            }
          }
          @if (mediaAssets$ | async; as assets) {
            <div class="page m-y">
              @if (assets.pager) {
                <div class="pager">
                  <mat-paginator
                    (page)="onPageChange($event)"
                    [length]="assets.pager.totalItems"
                    [pageSize]="assets.pager.itemsPerPage"
                    [showFirstLastButtons]="true"
                    [hidePageSize]="true"
                    [pageIndex]="assets.pager.currentPage"
                    aria-label="Select page"
                  >
                  </mat-paginator>
                </div>
              }
            </div>
          }
        </div>
      </mat-drawer-content>
      <mat-drawer #uploadDrawer mode="over" [opened]="false" position="end">
        <div class="media-upload p-5">
          <ngx-file-drop
            dropZoneLabel="Drop files here"
            (onFileDrop)="dropped($event)"
            [multiple]="true"
            accept=".png,.jpg,.jpeg"
          >
            <ng-template
              ngx-file-drop-content-tmp
              let-openFileSelector="openFileSelector"
            >
              <div class="flex flex-col gap-5 justify-center items-center">
                <span class="text-sm">拖拽文件到这里批量上传</span>
                <app-btn
                  (click)="openFileSelector()"
                  [content]="{
                    label: '选择图片',
                    mode: 'raised',
                    color: 'primary',
                    icon: { svg: 'selection-search' },
                  }"
                ></app-btn>
              </div>
            </ng-template>
          </ngx-file-drop>
          <div
            class="upload-table w-full box-border my-5 text-sm text-gray-500"
          >
            <div class="flex flex-col gap-3">
              @for (item of files; track $index) {
                <mat-divider class="my-3"></mat-divider>
                <div class="flex justify-between items-center gap-2 truncate">
                  <div class="flex items-center gap-2">
                    <app-icon
                      [content]="{ svg: 'check', color: 'primary' }"
                    ></app-icon>
                    <div>
                      {{ item.filesize | bytes: 2 }}
                    </div>
                    <div>{{ item.filename }}</div>
                  </div>
                  <app-icon
                    (click)="onCopy(item.uri.url)"
                    class="cursor-pointer"
                    [content]="{ svg: 'content-copy' }"
                  ></app-icon>
                </div>
                <mat-divider class="my-3"></mat-divider>
              }
            </div>
          </div>
        </div>
      </mat-drawer>
    </mat-drawer-container>
  </div>
}
